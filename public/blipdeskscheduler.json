{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a5f855b2-7344-44ad-bf8b-75bccd63d288","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":false,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$connId":"con_3","$invalid":false,"$id":"35d42520-8a51-4415-83eb-c220e382bdeb"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"onboarding","root":true,"$position":{"top":"118px","left":"342px"},"$title":"In√≠cio","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"95b10ba8-e351-4d16-9b10-ce14961cb1fd","type":"text/plain"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$connId":"con_8","$invalid":false,"$id":"61d23b1d-0f2a-481a-8554-9551b2c3fcb9"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"fallback","$position":{"top":"587px","left":"358px"},"$title":"Exce√ß√µes","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Ol√° {{contact.name}}!\n√â um prazer falar com voc√™ üòä"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Ol√° {{contact.name}}!\n√â um prazer falar com voc√™ üòä"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"cf8c9892-92a7-4a39-b169-9b8f5f7ef7a4","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","$connId":"con_13","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$invalid":false,"$id":"8f359230-8478-43c6-bc97-38fdd7375035"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"TrackAnyAttendance","$invalid":false,"settings":{"extras":{},"category":"AtendimentosTotais","action":"AtendimentosTotais"}}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"welcome","$position":{"top":"250px","left":"342px"},"$title":"1.0 - Boas vindas","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#61D36F","label":"TrackEvent","id":"blip-tag-30c205c0-30d9-be4d-884d-d702761524ae","canChangeBackground":false}]},"error":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, n√£o consegui entender!"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, n√£o consegui entender!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a1f34699-dd5c-43b6-8345-fde58dc32c0d","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"error","$position":{"top":"587px","left":"596px"},"$title":"Erro padr√£o","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7fb24b66-f182-4a6b-82ec-17cd0d87cf16","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false,"$$hashKey":"object:804"}],"$conditionOutputs":[{"stateId":"3c555d39-68eb-466b-9063-6adeb01132fc","$connId":"con_18","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"isWorkTime","$$hashKey":"object:998"}],"$invalid":false,"$id":"4ee90664-4b47-4368-9d03-6b6f377fa208","$$hashKey":"object:976"},{"stateId":"95118c04-1f32-40df-b1b0-54fb24fa2fc7","$connId":"con_23","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isWorkTime","$$hashKey":"object:1025"}],"$invalid":false,"$id":"b98c1ce4-59fd-4a7e-ae8f-81dffa5f796f","$$hashKey":"object:977"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"CheckWorkTime","$invalid":false,"settings":{"function":"run","source":"//Default BLiP TimeZoneOffset = S√£o Paulo (GMT-3)\nconst DEFAULT_OFFSET = -3;\nconst TRUE = \"true\";\nconst FALSE = \"false\";\n\n// Receive the variables as parameters\nconst run = (workTime) => {\n  try {\n    if (workTime === undefined) {\n      return TRUE;\n    }\n\n    const today = nowUTC(DEFAULT_OFFSET);\n    const js = JSON.parse(workTime);\n\n    const weekDay = js.weekdays[today.getDay()];\n    const noWorkDays = js.noWorkDays;\n\n    return !checkDayOff(today, noWorkDays) &&\n      checkWorkHour(today, weekDay)\n      ? TRUE\n      : FALSE;\n  } catch (e) {\n    return FALSE;\n  }\n}\n\n//Check for holidays and/or dayoffs\nconst checkDayOff = (today, dateList) => {\n  const month =\n    today.getUTCMonth() < 9\n      ? \"0\" + (today.getUTCMonth() + 1)\n      : today.getUTCMonth() + 1;\n\n  const day =\n    today.getUTCDate() <= 9 ? \"0\" + today.getUTCDate() : today.getUTCDate();\n\n  const monthDay = month + \"-\" + day;\n\n  if (dateList.includes(monthDay)) {\n    return true;\n  }\n\n  return false;\n}\n\nconst checkWorkHour = (today, weekDay) => {\n  let startDate = null;\n  let endDate = null;\n\n  for (let i = 0; i < weekDay.workTimes.length; i++) {\n    startDate = utcDate(weekDay.workTimes[i].start);\n    endDate = utcDate(weekDay.workTimes[i].end);\n\n    if (today - startDate > 0 && endDate - today > 0) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n//Get now UTC Date\nconst nowUTC = (offset) => {\n  const now = new Date();\n  let utc_timestamp = Date.UTC(\n    now.getUTCFullYear(),\n    now.getUTCMonth(),\n    now.getUTCDate(),\n    now.getUTCHours(),\n    now.getUTCMinutes(),\n    now.getUTCSeconds(),\n    now.getUTCMilliseconds()\n  );\n\n  return new Date(utc_timestamp + offset * 3600 * 1000);\n}\n\n//Get UTC Date\nconst utcDate = (timeString) => {\n  const now = new Date();\n\n  const hour = getValueByString(\"hour\", timeString);\n  const minutes = getValueByString(\"minutes\", timeString);\n\n  const utc_timestamp = Date.UTC(\n    now.getUTCFullYear(),\n    now.getUTCMonth(),\n    now.getUTCDate(),\n    hour,\n    minutes,\n    0,\n    0\n  );\n  return new Date(utc_timestamp);\n}\n\n//Get hour/minute by string with pattern HH:mm\nconst getValueByString = (type, timeString) => {\n  if (type === \"hour\") {\n    return parseInt(timeString.substring(0, timeString.indexOf(\":\")));\n  } else if (type === \"minutes\") {\n    return parseInt(\n      timeString.substring(timeString.indexOf(\":\") + 1, timeString.length)\n    );\n  }\n\n  return 0;\n}","inputVariables":["resource.workTime"],"outputVariable":"isWorkTime","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6fa6f21b-154f-43f2-bb6c-aaf646da5580","$typeOfContent":"","type":"ExecuteScript","$title":"Executar workDays","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    const message = JSON.parse(input).schedulerMessage;\n    return message;\n}","inputVariables":["resource.workTime"],"outputVariable":"workDays","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","root":false,"$title":"2.0 - Verifica Hor√°rio Atendimento","$position":{"top":"239px","left":"606px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-fbbec315-50d7-af72-056b-1b6c21c94c4f","canChangeBackground":false}]},"95118c04-1f32-40df-b1b0-54fb24fa2fc7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"425aa5d2-fcf9-4094-a52c-73917f47875c","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"143e0124-ec4e-462d-8369-efc61791afe6","$connId":"con_28","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"hasAttendant"}],"$invalid":false,"$id":"9d0bc7ec-42c7-42ee-9c7f-473050bf73bb"},{"stateId":"4c0d9be0-bd3d-4e72-b105-a2ac741e5149","$connId":"con_33","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"hasAttendant"}],"$invalid":false,"$id":"52cd4db7-4839-474a-a011-3666f1eaa829"}],"$enteringCustomActions":[{"type":"ProcessCommand","$title":"CheckAgentsAvailability","$invalid":false,"settings":{"to":"postmaster@desk.msging.net","method":"get","uri":"/attendants","variable":"result"},"conditions":[]},{"type":"ExecuteScript","$title":"HandleCheckRequest","$invalid":false,"settings":{"function":"run","source":"// Receive the variables as parameters\nfunction run(result) {\n    result = JSON.parse(result);\n    \n    let hasAttendant = false;\n\n    if(result.resource && result.resource.total >= 1){\n        hasAttendant  = result.resource.items.some(function(attendant){\n            return attendant.status === 'Online';\n        });\n    }\n    return hasAttendant;\n}","inputVariables":["result"],"outputVariable":"hasAttendant","LocalTimeZoneEnabled":false}}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"95118c04-1f32-40df-b1b0-54fb24fa2fc7","root":false,"$title":"3.0 - Verifica Disponibilidade Atendentes","$position":{"top":"228px","left":"880px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-fbbec315-50d7-af72-056b-1b6c21c94c4f","canChangeBackground":false},{"background":"#FC91AE","label":"ProcessCommand","id":"blip-tag-b6a90796-d5b5-7a68-45f8-3699bd6873e3","canChangeBackground":false}]},"3c555d39-68eb-466b-9063-6adeb01132fc":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"aa0d29d3-bab1-427d-9188-93b3638acbcd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"aa0d29d3-bab1-427d-9188-93b3638acbcd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:368"},{"action":{"type":"SendMessage","settings":{"id":"504721a0-3d44-4e95-82cc-dd33718b906a","type":"text/plain","content":"Infelizmente n√£o temos atendentes dispon√≠veis agora. Nosso hor√°rio de atendimento √© de\n{{workDays}}","metadata":{}},"$cardContent":{"document":{"id":"504721a0-3d44-4e95-82cc-dd33718b906a","type":"text/plain","content":"Infelizmente n√£o temos atendentes dispon√≠veis agora. Nosso hor√°rio de atendimento √© de\n{{workDays}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:369"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"fd1c385b-7adc-4efb-b829-3b137d4e97c0","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false,"$$hashKey":"object:370"}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"TrackRequestsOutWorkTime","$invalid":false,"settings":{"extras":{},"category":"Solicita√ß√£o","action":"Fora Horario Atendimento"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","$invalid":false},"id":"3c555d39-68eb-466b-9063-6adeb01132fc","root":false,"$title":"2.1 - Fora do Hor√°rio de Atendimento","$position":{"top":"390px","left":"744px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#61D36F","label":"TrackEvent","id":"blip-tag-30c205c0-30d9-be4d-884d-d702761524ae","canChangeBackground":false}]},"desk:b69ef3a2-9983-48f8-9d40-16bad478a460":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b04c3ac0-5b0c-4f61-ade4-9adbd31ae1fc","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant"]}],"$invalid":false,"stateId":"2b9bfb62-6346-4762-99ab-733d0c00d1a3","$connId":"con_38","$id":"fec13811-ae23-4a84-9b95-48797852a14d"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClient"]}],"$invalid":false,"stateId":"2b9bfb62-6346-4762-99ab-733d0c00d1a3","$connId":"con_43","$id":"1f73d79b-1c17-4afd-b8f0-a46d516e9133"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClientInactivity"]}],"$invalid":false,"stateId":"2b9bfb62-6346-4762-99ab-733d0c00d1a3","$connId":"con_48","$id":"d8139e7e-144b-44ce-b2d4-3ee87cba01fb"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"GetEncodedContactIdentity","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:b69ef3a2-9983-48f8-9d40-16bad478a460"]}],"settings":{"function":"run","source":"function run(identity) {\n return (identity !== undefined) ? encodeURIComponent(identity) : identity;\n}","inputVariables":["input.message.fromidentity"],"outputVariable":"helpDeskEncodedFromIdentity","LocalTimeZoneEnabled":false}},{"type":"ProcessCommand","$title":"GetOpenTicket","conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:b69ef3a2-9983-48f8-9d40-16bad478a460"]}],"settings":{"from":"{{application.identifier}}@{{application.domain}}","to":"postmaster@desk.msging.net","method":"get","uri":"/tickets?$filter=customerIdentity%20eq%20%27{{helpDeskEncodedFromIdentity}}%27%20and%20%28status%20eq%20%27Open%27%20or%20status%20eq%20%27Waiting%27%20or%20status%20eq%20%27Assigned%27%29","variable":"helpDeskGetOpenTicketCommandResponse"},"$invalid":false},{"type":"ExecuteScript","$title":"TreatGetOpenTicketResponse","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:b69ef3a2-9983-48f8-9d40-16bad478a460"]}],"settings":{"function":"run","source":"function run(commandResponse) {\n    var response = JSON.parse(commandResponse)\n    var ticketExists = (response && response.resource && response.resource.items && response.resource.items.length > 0);\n  return ticketExists ? \"true\" : \"false\";\n}","inputVariables":["helpDeskGetOpenTicketCommandResponse"],"outputVariable":"helpDeskHasTicket","LocalTimeZoneEnabled":false}},{"type":"ProcessCommand","$title":"OpenTicketIfNotFound","conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"notEquals","values":["true"]}],"settings":{"from":"{{application.identifier}}@{{application.domain}}","to":"postmaster@desk.msging.net","method":"set","uri":"/tickets/{{helpDeskEncodedFromIdentity}}","variable":"helpDeskOpenTicketCommandResponse","type":"text/plain","resource":"{{input.content}}","metadata":{"server.shouldStore":true}},"$invalid":false},{"type":"ExecuteScript","$title":"TreatOpenTicketResponse","$invalid":false,"conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"notEquals","values":["true"]}],"settings":{"function":"run","source":"function run(commandResponse) {\n    var response = commandResponse ? JSON.parse(commandResponse) : {}\n    var ticketExists = response && response.type === \"application/vnd.iris.ticket+json\" && response.resource \n    return ticketExists ? \"true\" : \"false\";\n}","inputVariables":["helpDeskOpenTicketCommandResponse"],"outputVariable":"helpDeskHasTicket","LocalTimeZoneEnabled":false}},{"type":"ForwardMessageToDesk","settings":{},"$invalid":false}],"$leavingCustomActions":[{"type":"SetVariable","$title":"ResetHasTicket","settings":{"$invalid":false,"variable":"helpDeskHasTicket","value":"false"},"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant","ClosedClient","ClosedClientInactivity"]}],"$invalid":false}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","$invalid":false},"id":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","deskStateVersion":"2.0.1","root":false,"$title":"4.0 - Atendimento humano","$position":{"top":"239px","left":"1350px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2b9bfb62-6346-4762-99ab-733d0c00d1a3":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"b950d0ee-cd9b-4aec-949b-02b8242cbeea","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b950d0ee-cd9b-4aec-949b-02b8242cbeea","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"90ec55b8-aadd-4f92-bf1a-dec84eb60244","type":"text/plain","content":"Atendimento finalizado!"},"$cardContent":{"document":{"id":"90ec55b8-aadd-4f92-bf1a-dec84eb60244","type":"text/plain","content":"Atendimento finalizado!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"8b33aca6-bda4-4dec-8a22-5b5f51a2ec53","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8b33aca6-bda4-4dec-8a22-5b5f51a2ec53","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"6bfaa60e-ce61-43fb-978e-80b1c5a15d8d","type":"text/plain","content":"Em uma escala de 0 a 10, onde 0 √© nada satisfeito e 10 √© totalmente satisfeito, qual nota voc√™ d√° para esse atendimento?"},"$cardContent":{"document":{"id":"6bfaa60e-ce61-43fb-978e-80b1c5a15d8d","type":"text/plain","content":"Em uma escala de 0 a 10, onde 0 √© nada satisfeito e 10 √© totalmente satisfeito, qual nota voc√™ d√° para esse atendimento?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"64b7d83d-e2f4-4df4-8ad4-c9489c0f15f9","type":"text/plain","textContent":"Entrada do usu√°rio","content":"score"},"editable":false,"deletable":true,"position":"right"},"$invalid":false,"variable":"score"},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"a0151d70-16b1-455c-9534-a15acac75993","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"a0151d70-16b1-455c-9534-a15acac75993","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"dea1d712-9374-4990-8f99-5f38a06d5263","type":"text/plain","content":"Obrigado pela participa√ß√£o.","metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"dea1d712-9374-4990-8f99-5f38a06d5263","type":"text/plain","content":"Obrigado pela participa√ß√£o."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"NormalizeScore","$invalid":false,"settings":{"function":"run","source":"// Receive the variables as parameters\nfunction run(score) {\n    if(isNumeric(score)){\n       score = parseInt(score);\n       if(score < 0) return 0;\n       if(score > 10) return 10;\n       return score;\n    }\n    return \"Outro\";\n}\n\n//check if a string has a number\nfunction isNumeric(num){\n  return !isNaN(num)\n}","inputVariables":["score"],"outputVariable":"score"}},{"type":"TrackEvent","$title":"TrackScoreValue","$invalid":false,"settings":{"extras":{},"category":"Score","action":"{{score}}"}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"2b9bfb62-6346-4762-99ab-733d0c00d1a3","root":false,"$title":"5.0 - Nota de atendimento","$position":{"top":"239px","left":"1602px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#61D36F","label":"TrackEvent","id":"blip-tag-30c205c0-30d9-be4d-884d-d702761524ae"},{"background":"#FF961E","label":"ExecuteScript","id":"blip-tag-fbbec315-50d7-af72-056b-1b6c21c94c4f"}]},"143e0124-ec4e-462d-8369-efc61791afe6":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"95011b31-5279-4d98-968d-b5af3c6d6b26","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"95011b31-5279-4d98-968d-b5af3c6d6b26","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"2d2d011a-e3d5-4807-a347-d6cd9b3f43c8","type":"text/plain","content":"Desculpe, n√£o temos atendentes dispon√≠veis no momento. Por favor, tente novamente mais tarde."},"$cardContent":{"document":{"id":"2d2d011a-e3d5-4807-a347-d6cd9b3f43c8","type":"text/plain","content":"Desculpe, n√£o temos atendentes dispon√≠veis no momento. Por favor, tente novamente mais tarde."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"76137ac2-42ab-4ee9-aef7-743cb9160a98","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"TrackRequestsWithoutAgent","$invalid":false,"settings":{"extras":{},"category":"Solicita√ß√£o","action":"Sem Atendente"}},{"type":"TrackEvent","$title":"TrackAbsoluteNotAvailableAgents","$invalid":false,"settings":{"extras":{},"category":"Atendentes Indispon√≠veis","action":"Atendentes Indispon√≠veis"}}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","$invalid":false},"id":"143e0124-ec4e-462d-8369-efc61791afe6","root":false,"$title":"3.2 - Nenhum atendente dispon√≠vel","$position":{"top":"390px","left":"998px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#61D36F","label":"TrackEvent","id":"blip-tag-30c205c0-30d9-be4d-884d-d702761524ae","canChangeBackground":false}]},"4c0d9be0-bd3d-4e72-b105-a2ac741e5149":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"adaea5c6-03e0-4ba5-9ef6-e1e3f9e9067e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"adaea5c6-03e0-4ba5-9ef6-e1e3f9e9067e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"04835382-935c-4372-8778-69b4b0912d60","type":"text/plain","content":"A partir de agora um de nossos atendentes vai respond√™-lo."},"$cardContent":{"document":{"id":"04835382-935c-4372-8778-69b4b0912d60","type":"text/plain","content":"A partir de agora um de nossos atendentes vai respond√™-lo."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"96272fb2-b301-4611-921b-69aa74791395","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"96272fb2-b301-4611-921b-69aa74791395","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"8f63c111-4933-4e07-a9be-574ca9d0fbda","type":"text/plain","content":"Como podemos ajud√°-lo?"},"$cardContent":{"document":{"id":"8f63c111-4933-4e07-a9be-574ca9d0fbda","type":"text/plain","content":"Como podemos ajud√°-lo?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"86667929-c0a7-473d-b066-fbed10260d73","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"desk:b69ef3a2-9983-48f8-9d40-16bad478a460","$connId":"con_53","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$invalid":false,"$id":"e8535de5-7dff-41a0-8426-72c8abeb0a88"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"TrackAttendances","$invalid":false,"settings":{"extras":{},"category":"AtendimentosRealizados","action":"AtendimentosRealizados"}}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"4c0d9be0-bd3d-4e72-b105-a2ac741e5149","root":false,"$title":"3.1 - Atendente dispon√≠vel","$position":{"top":"239px","left":"1112px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#61D36F","label":"TrackEvent","id":"blip-tag-30c205c0-30d9-be4d-884d-d702761524ae","canChangeBackground":false}]}},"globalAction":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}